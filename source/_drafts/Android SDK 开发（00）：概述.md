---
title: Android SDK 开发（00）：概述
permalink: android-sdk-developer-override
comments: true
date: 2019-03-06 15:10:24
updated: 2019-03-06 15:10:24
tags:
  - Android SDK 概述
categories:
  - Android SDK
---

广泛意义上的 `SDK` 一般指特定的用于应用程序开发的工具包，例如 `Android` 开发过程中使用的 `Android SDK`。而狭义上的 `SDK` 则是基于广义 `SDK` 开发的独立于具体业务且能够完成特定功能的一组工具的集合，例如支付宝的支付 `SDK`、极光的推送 `SDK`以及各种广告 `SDK`等。

通常情况下，`SDK` 在应用程序开发过程中是作为特定功能的提供者的角色出现的。

与 `Android` 应用程序开发人员面向的是最终用户所不同的是，`SDK` 开发者往往面对的是应用程序开发人员。由于 `SDK` 自身的特性以及分发方式、对宿主的侵入性、风险考量等因素的影响，与应用程序开发所不同的是，`SDK` 对于稳定性的要求变得极为苛刻。应用程序开发过程中可以通过版本迭代的方式快速（相对于 `SDK` 的发版情况）推进新的需求或者修复发现的问题，而 `SDK` 由于受其自身版本发布的特性（只能嵌入到宿主的项目中）的制约，对于新的需求的推进或者 `BUG` 修复之后的版本迭代将会变得极其缓慢，且在一定程度上成倍的增加了沟通成本。

本系列文章将围绕 `SDK` 开发的主题，在架构设计、设计指标、测试、版本发布以及安全性等方面展开讨论。整个 `Android SDK` 开发系列的文章基于肥肥近几年来 `SDK` 开发过程中总结的经验。

由于肥肥自身知识储备的局限性，本系列文章所讨论的内容并不具备普适性。如果您对本系列文章中的观点持有不同的意见，欢迎您发邮件给我 `fiissh.zhao@gmail.com`。

## SDK 产品设计

### SDK 与应用程序在产品设计方面的差异

`SDK` 的产品设计更多的是侧重于产品功能逻辑的设计。大多数情况下，`SDK` 是以 `API` 的形式对外提供服务。对于 `SDK` 开发人员来说，很多时候也要充当产品经理的角色参与到 `SDK` 的产品设计过程中。而由于 `SDK` 在测试和发版方面的特殊性，又要求我们必须在 `SDK` 产品设计的早期就要考虑这些因素。

不同于应用程序开发过程中的产品设计要面向特定用户群体的设计思路，`SDK` 产品的设计则是面向特定的场景。大多数应用程序在设计之初，其面向的用户群体有着显著的群体特征，这就决定了应用类的产品在一开始就有了显著的用户画像，产品人员可以根据显著的用户特征和用户习惯来调整应用程序的功能、界面等设计。

`SDK` 类型的产品则是面向特定的使用场景，与用户群体无关。这也就要求 `SDK` 类型的产品在设计上要具备一定的普适性。

### SDK 与应用程序在迭代计划方面的差异

相对于应用程序的产品迭代速度（在正式版方面），`SDK` 类型的产品迭代速度往往会慢很多。一方面，`SDK` 类型的产品受限于测试过程，无法达到应用程序类型的产品发版速度，另一方面，`SDK` 类型的产品在发版之后，往往还有漫长的与宿主对接的过程。

这也就要求我们在 `SDK` 发版方面一定要慎重。一旦线上版本大规模出现问题，`SDK` 类型的产品从发现问题到宿主接入发版需要相对漫长的时间，由此带来的损失将会变得非常高昂。

`SDK` 类型的产品往往通过如下两种方式的使用（或者两种方式都使用）来保证线上版本的稳定性以及对突出状况的紧急应对：

* 发版前的线上测试：通常情况下，`SDK` 产品的开发团队都会维护有至少一个针对于 `SDK` 功能点全覆盖的测试应用程序（用户量级在百万级及以上最好）。在 `SDK` 正式发版前的阶段（通常是 `Beta` 版本阶段），通过专门的测试应用程序对 `SDK` 进行全功能覆盖的线上测试是非常有必要的。一方面能够针对的用户的真实环境进行测试，提前发现并解决问题。另一方面，可以在测试应用程序中接入 `SDK` 产品不方便接入的异常捕获和性能分析等一些辅助服务，这样能够获取到较为全面的崩溃、`ANR` 和性能方面的数据。
* 细粒度的多维度云控系统：云端配置控制系统为我们提供了线上版本出现问题之后唯一的应对通道。通常情况下，如果 `SDK` 中的每一个模块都尽可能的配置了云端控制系统，并提供相应的容错机制，那么在线上版本出现问题时，至少能够启用紧急预案，将出现问题的模块屏蔽。云端控制系统和崩溃系统相结合的方式，可以有效地降低线上 `SDK` 出现问题时对宿主产品的影响。如果配置下发能够精确到单一用户，那么就可以实现多样化、细粒度的云端控制。

云控系统的主要目的是提供了一种线上版本出现大规模问题时的紧急应对方案，在实际的开发过程中，严格的代码质量控制、严格且全面的测试才是保证线上版本的重要手段。

`SDK` 产品迭代的详细内容，会在本系列的其他文章中展开讨论。

### SDK 与应用程序在服务器资源配置方面的差异

在一定情况下，应用程序的用户增长和活跃模型是可预测的。这也就意味着我们可以有计划地增加服务器资源以保证服务端的稳定性。严格来说，`SDK` 类型的产品的用户增长和活跃模型也是可以预测的，但是 `SDK` 类型的产品由于其用户量级和活跃程度与宿主产品有关，这在一定程度上使得我们无法很好的预估服务器资源的开销。

实时有效的服务器资源监控以及动态配置（扩容和降容）将变得尤为重要。这可以在一定程度上降低由于访问量激增所带来的一系列问题。基于集群和微服务的服务端架构能够很好地规避着一些问题。

### SDK 与应用程序在使用三方资源方面的差异

三方资源通常是指提供特定功能的 `SDK` 以及开源框架等。通常情况下，`SDK` 中很少会依赖额外的第三方的 `SDK`（当然也会存在一些例外，例如广告聚合 `SDK` 等）。

相对于应用程序，`SDK` 在使用开源框架方面会更为慎重一些。一方面，宿主对于接入的 `SDK` 的包体积是很敏感的。使用开源框架需要引入额外的包（`aar` 或者 `jar`）。这在一定程度上增加了宿主的接入成本。另一方面，`SDK` 中使用开源项目会为宿主带来额外的法律风险。受限于开源项目的开源协议，可能会要求宿主产品针对 `SDK` 使用的开源项目做特别说明。再者，如果 `SDK` 和宿主产品使用了同一个第三方框架的不同版本，也会带来一些不必要的麻烦。

`SDK` 使用第三方框架时需要慎重考量，如果使用第三方框架所带来的收益不能覆盖所带来的风险成本，那最好的方案是选择不使用。关于第三方框架的使用，会在本系列的其他文章中做详细讨论。

### SDK 与应用程序在产品交付方面的差异

通常情况下，应用程序类产品的交付是安装包（`apk` 文件）的形式通过渠道商（`Google Play` 等）进行分发。而 `SDK` 类型的产品通常只有官网一个渠道对 `aar` 文件或者 `jar` 文件进行分发。另外，`SDK` 产品还需要提供额外的接入手册、说明手册等文档类产品以及演示用的 `Sample` 项目。

应用程序产品往往会面向用户提供测试版等非正式版本，而 `SDK` 则通常只能提供正式版（但是不排除在某些情况下，宿主选择接入 `Beta` 阶段甚至更早阶段的 `SDK` 的情况）。这是由于相较于应用程序能够快速迭代的特性，`SDK` 类型的产品在版本迭代方面成本过高造成的。

关于 `SDK` 类型的产品的发布渠道、接入手册等内容，会在本系列的其他文章中做详细讨论。

## SDK 设计目标

对于应用程序最终用户来说，大多数情况下他们是感知不到 `SDK` 的存在的（作者注：此处说法不是很确切）。从另一个角度来说，`SDK` 运行期间的资源开销（内存、电量、流量等）、需要的权限、出现的崩溃以及不兼容的情况，最终都归会给应用程序带来影响。这也就要求 `SDK` 开发人员把提升性能降低资源占用以及提升稳定性兼容性作为最重要的设计目标。

`SDK` 在开发过程中对于宿主主线程的使用也需要格外的慎重。理想情况下，在 `Android` 的体系架构中，主线程一般只用来渲染界面和处理用户交互事件。对于主线程过多的占用将会为宿主带来卡顿甚至 `ANR` 的风险。

对于大多数应用程序来说，其包体积的大小是衡量应用程序质量的重要指标。这也就意味着宿主对于接入的 `SDK` 的包体积变得尤为敏感。

对于全球化的应用程序来说，除了需要符合 `Google Play` 的的隐私政策之外，规避各个国家和地区额外的隐私条款也是非常重要的。`SDK` 作为应用程序的一部分，需要在隐私风险方面格外慎重。最基本的原则是尽可能不使用、不收集涉及隐私风险的数据或 `API`，如果必须使用，需要对此功能做出详细说明以及风险披露。

`SDK` 的设计目标会在本系列的其他文章中做详细说明。

## 总结

本文是 `Android SDK` 开发系列的第一篇文章，主要介绍了 `SDK` 和应用程序开发在产品设计以及设计目标方面的差异。在后续的文章中，将会围绕技术选型、`API` 设计、错误处理、数据交互、版本管理、文档管理以及测试等方面展开讨论。
